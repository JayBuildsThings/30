<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>30 Seconds: SA Edition</title>
    
    <!-- PWA Linkages -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#7c3aed">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/svg+xml" href="icon.svg">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }
        
        .game-card {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 8px 10px -6px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .game-card.active {
            transform: scale(1.02);
        }
        
        /* New style for when round ends but card is still visible */
        .game-card.expired {
            filter: grayscale(0.2);
            border-color: #ef4444; /* Red border */
        }

        .timer-container {
            width: 100%;
            height: 8px;
            background-color: #374151;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .timer-bar {
            height: 100%;
            background-color: #10b981;
            width: 100%;
            transition: width 1s linear, background-color 1s linear;
        }

        .timer-bar.warning { background-color: #f59e0b; }
        .timer-bar.danger { background-color: #ef4444; }

        #install-btn.hidden { display: none; }
        
        .tap-highlight-transparent {
            -webkit-tap-highlight-color: transparent;
        }

        /* Toggle Switch Styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #a855f7; /* purple-500 */
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #a855f7; /* purple-500 */
        }
        .toggle-checkbox {
            right: 44px;
            z-index: 1;
            border-color: #4b5563;
            transition: all 0.3s;
        }
        .toggle-label {
            transition: background-color 0.3s;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col overflow-hidden select-none">

    <!-- Header -->
    <header class="flex justify-between items-center p-4 bg-gray-800 border-b border-gray-700 z-10">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-stopwatch text-purple-500 text-2xl"></i>
            <h1 class="font-bold text-xl tracking-wide">30 Seconds <span class="text-xs text-purple-400 block font-normal">SA Edition</span></h1>
        </div>
        <button id="install-btn" class="hidden bg-purple-600 hover:bg-purple-500 text-white text-xs font-bold py-2 px-3 rounded-full transition">
            <i class="fa-solid fa-download mr-1"></i> Install
        </button>
        <button onclick="toggleSettings()" class="text-gray-400 hover:text-white p-2" aria-label="Open Settings">
            <i class="fa-solid fa-gear text-xl"></i>
        </button>
    </header>

    <!-- Main Game Area -->
    <main class="flex-grow flex flex-col items-center justify-center p-4 relative w-full max-w-md mx-auto">
        
        <!-- Score / Team Display -->
        <div class="w-full flex justify-between mb-4 px-2 text-sm font-semibold text-gray-400">
            <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                <span>Team A</span>
            </div>
            <div class="flex items-center gap-2">
                <span>Team B</span>
                <span class="w-3 h-3 rounded-full bg-red-500"></span>
            </div>
        </div>

        <!-- The Card -->
        <div id="card-container" class="game-card w-full aspect-[3/4] rounded-2xl p-6 flex flex-col justify-between items-center relative mb-6 border-4 border-white/20 transition-all duration-300">
            
            <!-- Start View -->
            <div id="start-view" class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 text-gray-900">
                <i class="fa-solid fa-earth-africa text-5xl mb-4 opacity-50"></i>
                <h2 class="text-3xl font-black uppercase mb-2">Ready?</h2>
                <p class="font-semibold opacity-75">Local is Lekker.</p>
                <p class="text-sm opacity-60 mt-2">Tap below to start.</p>
            </div>

            <!-- Game View -->
            <div id="game-view" class="w-full h-full flex flex-col hidden text-gray-900">
                <div class="w-full flex justify-between items-start mb-2 opacity-60">
                    <span class="text-xs font-bold tracking-widest uppercase">South Africa</span>
                    <i id="card-icon" class="fa-solid fa-flag"></i>
                </div>

                <div class="flex-grow flex flex-col justify-center gap-5">
                    <div class="word-item font-bold text-2xl md:text-3xl text-center border-b-2 border-black/10 pb-1">Loading...</div>
                    <div class="word-item font-bold text-2xl md:text-3xl text-center border-b-2 border-black/10 pb-1">Loading...</div>
                    <div class="word-item font-bold text-2xl md:text-3xl text-center border-b-2 border-black/10 pb-1">Loading...</div>
                    <div class="word-item font-bold text-2xl md:text-3xl text-center border-b-2 border-black/10 pb-1">Loading...</div>
                    <div class="word-item font-bold text-2xl md:text-3xl text-center border-b-2 border-black/10 pb-1">Loading...</div>
                </div>

                <div class="mt-auto pt-4 text-center">
                   <div id="card-footer-text" class="inline-block bg-black/10 rounded px-2 py-1 text-xs font-bold uppercase tracking-wider">
                       Dont say the word!
                   </div>
                </div>
            </div>
        </div>

        <!-- Timer -->
        <div class="w-full mb-6">
            <div class="flex justify-between text-2xl font-mono font-bold mb-1">
                <span id="timer-display" class="text-white">30</span>
                <span id="timer-label" class="text-gray-500 text-sm self-end pb-1">seconds</span>
            </div>
            <div class="timer-container">
                <div id="timer-bar" class="timer-bar bg-green-500"></div>
            </div>
        </div>

        <!-- Controls -->
        <button id="action-btn" class="w-full py-4 bg-purple-600 active:bg-purple-700 text-white font-bold text-xl rounded-xl shadow-lg shadow-purple-900/50 transition transform active:scale-95 tap-highlight-transparent">
            Start Round
        </button>

    </main>

    <!-- Footer -->
    <footer class="text-center p-4 text-gray-500 text-xs">
        <p>Made for SA | Does not use data</p>
    </footer>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-black/60 transition-opacity" aria-hidden="true" onclick="toggleSettings()"></div>
        <div class="absolute bottom-0 w-full md:w-[28rem] md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-gray-800 rounded-t-3xl md:rounded-2xl shadow-xl transition-transform transform translate-y-0">
            <div class="flex justify-between items-center p-6 border-b border-gray-700">
                <h3 class="text-xl font-bold">Settings</h3>
                <button onclick="toggleSettings()" class="text-gray-400 hover:text-white p-2 -mr-2" aria-label="Close">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-8">
                <div>
                    <h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Audio</h4>
                    <div class="flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="font-medium">Sound Effects</span>
                            <span class="text-xs text-gray-400">Play ticking and alarm sounds</span>
                        </div>
                        <div class="relative inline-block w-14 h-8 align-middle select-none">
                            <input type="checkbox" id="sound-toggle" checked class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                            <label for="sound-toggle" class="toggle-label block overflow-hidden h-8 rounded-full bg-gray-600 cursor-pointer"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-gray-700">
                <button onclick="toggleSettings()" class="w-full py-4 bg-purple-600 hover:bg-purple-500 text-white font-bold text-lg rounded-xl transition tap-highlight-transparent">
                    Apply Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Audio -->
    <audio id="sound-tick" src="https://assets.mixkit.co/sfx/preview/mixkit-game-ball-tap-2073.mp3"></audio>
    <audio id="sound-end" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-tone-996.mp3"></audio>

    <script>
        // --- CATEGORIZED DATA (Guaranteed Diversity) ---
        const categories = {
            nostalgia: [
                "M-Net Open Time", "KTV", "Takalani Sesame", "Dragon Ball Z", "Generations (Old)",
                "BBM (Blackberry)", "Nokia 3310", "Please Call Me", "MXit", "MSN Messenger",
                "Pokemon Tazos", "Beyblades", "Tamagotchi", "YoTV", "Craz-e",
                "Spur Birthday Song", "Wicks Bubblegum", "Chappies Did You Know", "Dub (The alien)", "Fizzer",
                "Simunye Grooves", "Ouma Rusks", "Teletext", "Lolly Lounge"
            ],
            brands: [
                "Checkers Sixty60", "Nando's", "Mr D Food", "Spar Tops", "Outsurance",
                "Castle Lite", "Black Label", "Klipdrift", "Amarula", "Oros",
                "Woolworths Water", "Simba Chips", "Chappies", "Grandpa Powder", "Zambuk",
                "FNB eBucks", "Capitec", "Discovery Vitality", "Takealot", "Superbalist",
                "Shein", "Uber Eats", "Prime Drink", "Investec", "Standard Bank"
            ],
            culture: [
                "Load Shedding", "EskomSePush", "Potholes", "Car Guard", "Hadeda",
                "Braai", "Potjiekos", "Biltong", "Droewors", "Melktert",
                "Taxi Gaartjie", "Lekker", "Eish", "Now Now", "Just Now",
                "Shame", "Yoh", "Awe", "Jol", "Bakkie", "Tekkies",
                "Bunny Chow", "Gatsby", "Koesister", "Garage Pie", "Roadhouse", "Pap & Wors"
            ],
            people: [
                "Siya Kolisi", "Rassie Erasmus", "Trevor Noah", "Black Coffee", "Tyla (Water)",
                "Uncle Waffles", "Cyril Ramaphosa", "Elon Musk", "Dricus du Plessis", "Caster Semenya",
                "Nelson Mandela", "Desmond Tutu", "Charlize Theron", "AB de Villiers", "Sho Madjozi",
                "The Kiffness", "Leon Schuster", "Brenda Fassie", "Hugh Masekela", "Wayde van Niekerk"
            ],
            places: [
                "Table Mountain", "Kruger National Park", "Soweto", "Drakensberg", "Sun City",
                "Gautrain", "The N1 Highway", "Robben Island", "V&A Waterfront", "Gold Reef City",
                "uShaka Marine World", "Hole in the Wall", "Chapman's Peak", "District Six",
                "Home Affairs", "SABC License", "SASSA", "Traffic Circle", "Robot (Light)"
            ]
        };

        // --- STATE & DOM ---
        let isPlaying = false;
        let isReviewing = false; // New state for checking answers
        let timeLeft = 30;
        let timerInterval = null;
        
        const startView = document.getElementById('start-view');
        const gameView = document.getElementById('game-view');
        const actionBtn = document.getElementById('action-btn');
        const timerDisplay = document.getElementById('timer-display');
        const timerLabel = document.getElementById('timer-label');
        const timerBar = document.getElementById('timer-bar');
        const cardContainer = document.getElementById('card-container');
        const cardFooter = document.getElementById('card-footer-text');
        const wordItems = document.querySelectorAll('.word-item');
        const soundTick = document.getElementById('sound-tick');
        const soundEnd = document.getElementById('sound-end');

        // --- CORE FUNCTIONS ---

        function startGame() {
            isPlaying = true;
            isReviewing = false;
            timeLeft = 30;
            
            // UI Reset
            startView.classList.add('hidden');
            gameView.classList.remove('hidden');
            gameView.classList.add('flex');
            
            // Card Reset
            cardContainer.classList.add('active');
            cardContainer.classList.remove('expired');
            cardFooter.textContent = "Dont say the word!";
            cardFooter.parentElement.classList.remove('opacity-0');

            // Button Reset
            actionBtn.textContent = "Next Card / Skip";
            actionBtn.classList.replace('bg-purple-600', 'bg-gray-700');
            actionBtn.classList.remove('bg-blue-600');

            // Timer Reset
            timerDisplay.textContent = "30";
            timerLabel.textContent = "seconds";
            timerBar.style.width = '100%';
            timerBar.className = 'timer-bar bg-green-500';

            generateDiverseCard();

            clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
        }

        function endRoundLogic() {
            // STOP EVERYTHING BUT KEEP CARD
            clearInterval(timerInterval);
            isPlaying = false;
            isReviewing = true;
            
            // Play Sounds/Vibrate
            if (document.getElementById('sound-toggle').checked) {
                soundEnd.play().catch(e => {});
            }
            if (navigator.vibrate) navigator.vibrate([200, 100, 400]);

            // Visual Updates for "Review Mode"
            timerDisplay.textContent = "TIME'S UP";
            timerLabel.textContent = "";
            timerBar.style.width = '100%';
            timerBar.className = 'timer-bar danger';
            
            // Mark Card as Expired (Visual Cue)
            cardContainer.classList.remove('active');
            cardContainer.classList.add('expired');
            cardFooter.textContent = "Count your score";

            // Change Button to "Finish"
            actionBtn.textContent = "Finish Round";
            actionBtn.classList.replace('bg-gray-700', 'bg-blue-600');
        }

        function resetToHome() {
            isReviewing = false;
            
            startView.classList.remove('hidden');
            gameView.classList.add('hidden');
            gameView.classList.remove('flex');
            
            cardContainer.classList.remove('expired');
            
            actionBtn.textContent = "Start Round";
            actionBtn.classList.replace('bg-blue-600', 'bg-purple-600');
            
            timerDisplay.textContent = "30";
            timerLabel.textContent = "seconds";
            timerBar.style.width = '100%';
            timerBar.className = 'timer-bar bg-green-500';
        }

        function updateTimer() {
            timeLeft--;
            timerDisplay.textContent = timeLeft;
            
            const percentage = (timeLeft / 30) * 100;
            timerBar.style.width = `${percentage}%`;

            if (timeLeft <= 10) {
                timerBar.className = 'timer-bar warning';
                if (document.getElementById('sound-toggle').checked && timeLeft > 0) {
                   soundTick.currentTime = 0;
                   soundTick.play().catch(e => {});
                }
            }
            if (timeLeft <= 5) {
                timerBar.className = 'timer-bar danger';
            }

            if (timeLeft <= 0) {
                endRoundLogic();
            }
        }

        function generateDiverseCard() {
            // 1. Pick one random word from each category
            const keys = Object.keys(categories);
            let selectedWords = keys.map(key => {
                const list = categories[key];
                return list[Math.floor(Math.random() * list.length)];
            });

            // 2. Shuffle to mix order
            for (let i = selectedWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [selectedWords[i], selectedWords[j]] = [selectedWords[j], selectedWords[i]];
            }

            // 3. Render
            selectedWords.forEach((word, index) => {
                wordItems[index].textContent = word;
            });
        }

        // --- EVENT LISTENERS ---

        actionBtn.addEventListener('click', () => {
            if (!isPlaying && !isReviewing) {
                // CASE: IDLE -> START
                startGame();
            } else if (isPlaying) {
                // CASE: PLAYING -> SKIP
                if(confirm("Skip this card? (You lose 5s)")) {
                   generateDiverseCard();
                   timeLeft = Math.max(0, timeLeft - 5);
                   updateTimer(); 
                }
            } else if (isReviewing) {
                // CASE: REVIEWING -> HOME
                resetToHome();
            }
        });

        function toggleSettings() {
            document.getElementById('settings-modal').classList.toggle('hidden');
        }

        // --- PWA INSTALLATION ---
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.classList.add('hidden');
                }
                deferredPrompt = null;
            }
        });

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Error', err));
            });
        }
    </script>
</body>
</html>


